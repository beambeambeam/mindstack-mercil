<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô | MERCIL MYAPP</title>

    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
</head>
<body>

    <header class="main-header">
        <div class="logo">MERCIL</div>
        
        <nav class="asset-filter-nav">
            <a href="index.html" class="nav-link">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        </nav>
        
        <div class="user-actions">
            <button class="action-btn login-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° / ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
        </div>
    </header>

    <main class="content-container">
        
        <h1>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</h1>

        <div class="search-bar" id="main-search-bar">
            <input type="text" id="search-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå (Asset Code)..." autofocus>
            <button id="search-button"> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>

        <div class="asset-grid-wrapper">
            <div id="asset-card-container">
                <p style="text-align: center; grid-column: 1 / -1; padding: 50px; font-size: 1.2em; color: #777;">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</p>
            </div>
        </div>

    </main>

    <div class="bottom-nav-bar">
        <a href="index.html" class="nav-item">
            <span class="icon">üè†</span>
            <span class="label">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
        </a>
        <a href="search.html" class="nav-item active"> <span class="icon">üîç</span>
            <span class="label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span>
        </a>
        <a href="chat.html" class="nav-item">
            <span class="icon">üí¨</span>
            <span class="label">‡∏ï‡∏≠‡∏ö‡πÅ‡∏ä‡∏ó</span>
        </a>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-2Pmvv0kuTBOz1pG4zFp3gLzmgh4iI5Lp7lT8W/Jq9rM="
    crossorigin=""></script>
    <script src="app.js"></script> 
    


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Properties ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å app.js
        const properties = window.properties; 
        
        // **[‡πÉ‡∏´‡∏°‡πà]** ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö Filters ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÑ‡∏î‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        let latestParsedFilters = {}; 


        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Search Logic (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Hybrid Search API)
        async function applySearch() { 
            const searchInput = document.getElementById('search-input');
            const searchTerm = searchInput ? searchInput.value.trim() : '';
            const container = document.getElementById('asset-card-container');
            
            // -----------------------------------------------------------
            // A. [‡πÉ‡∏´‡∏°‡πà] ‡πÅ‡∏¢‡∏Å Filter ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Query ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Search API
            // -----------------------------------------------------------
            if (window.parseQueryForFilters) {
                 latestParsedFilters = window.parseQueryForFilters(searchTerm); 
            } else {
                 latestParsedFilters = { query: searchTerm };
            }
            // -----------------------------------------------------------

            
            if (!searchTerm) {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                const allResults = window.simpleTextSearch(''); 
                if (window.renderAssetCards) {
                     window.renderAssetCards(allResults);
                }
                return;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
            container.innerHTML = `<p style="text-align: center; grid-column: 1 / -1; padding: 50px; font-size: 1.2em; color: #1d7874;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞...</p>`;


            // **‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Hybrid Search**
            const results = await window.hybridSearchAPI(searchTerm); 

            if (results.length === 0) {
                // -----------------------------------------------------------------
                // **B. [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (Zero Result Alternative)**
                // -----------------------------------------------------------------
                let zeroResultHTML = `<p style="text-align: center; grid-column: 1 / -1; padding: 30px; font-size: 1.2em; color: #d64545;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö "${searchTerm}"</p>`;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ Filter ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ú‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const queryHasFilters = latestParsedFilters.price_max || latestParsedFilters.radius_km;

                if (queryHasFilters && window.formatPrice) {
                    
                    const newPrice = latestParsedFilters.price_max ? window.formatPrice(latestParsedFilters.price_max * 1.1) : null;
                    const newRadius = latestParsedFilters.radius_km ? (latestParsedFilters.radius_km * 1.5).toFixed(0) : null;
                    
                    // ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢ (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≤‡∏Å Filter)
                    const baseQuery = latestParsedFilters.query.trim(); 

                    let alternativePriceQuery = '';
                    if (latestParsedFilters.price_max) {
                        alternativePriceQuery = `${baseQuery} ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${newPrice} ‡∏ö‡∏≤‡∏ó`;
                    }
                    
                    let alternativeRadiusQuery = '';
                    if (latestParsedFilters.radius_km && latestParsedFilters.location_keyword) {
                         alternativeRadiusQuery = `${baseQuery} ‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ ${newRadius} km ‡∏à‡∏≤‡∏Å ${latestParsedFilters.location_keyword}`;
                    } else if (latestParsedFilters.radius_km) {
                         alternativeRadiusQuery = `${baseQuery} ‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ ${newRadius} km`;
                    }
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                    zeroResultHTML += `
                        <div style="text-align: center; grid-column: 1 / -1; margin-top: 20px; padding: 20px; background: #fff;">
                            <h3 style="color: #1a4f6d;">üí° ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</h3>
                            <p>‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏™‡∏ô‡πÉ‡∏à:</p>
                            <ul>
                                ${newPrice && alternativePriceQuery ? `<li><a href="#" onclick="searchByAlternative('${alternativePriceQuery}', event)">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏õ‡πá‡∏ô <strong>${newPrice} ‡∏ö‡∏≤‡∏ó</a></strong> (‡πÄ‡∏û‡∏¥‡πà‡∏° 10%)</li>` : ''}
                                ${newRadius && alternativeRadiusQuery ? `<li><a href="#" onclick="searchByAlternative('${alternativeRadiusQuery}', event)">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏î‡∏¢‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏±‡∏®‡∏°‡∏µ‡πÄ‡∏õ‡πá‡∏ô <strong>${newRadius} ‡∏Å‡∏°.</a></strong> (‡∏Ç‡∏¢‡∏≤‡∏¢ 50%)</li>` : ''}
                            </ul>
                        </div>
                    `;
                }
                
                container.innerHTML = zeroResultHTML;
                // -----------------------------------------------------------------

            } else {
                if (window.renderAssetCards) {
                    window.renderAssetCards(results); 
                }
            }
        }
        
        // C. [‡πÉ‡∏´‡∏°‡πà] ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (Zero Result Alternative)
        window.searchByAlternative = function(alternativeQuery, event) {
            if (event) event.preventDefault();
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.value = alternativeQuery;
                applySearch();
            }
        }


        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');

        // ‡∏ú‡∏π‡∏Å Event Listener (‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°)
        if (searchInput) {
            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    applySearch();
                } else if (searchInput.value.trim().length > 2 || searchInput.value.trim().length === 0) {
                     // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏£‡∏ö 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏´‡∏°‡∏î
                     applySearch();
                }
            });
        }
        
        if (searchButton) {
            searchButton.addEventListener('click', applySearch);
        }
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        applySearch();
        
        if (searchInput) {
            searchInput.focus();
        }
    });
    </script>


    
</body>
</html>